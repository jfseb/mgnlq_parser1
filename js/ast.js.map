{"version":3,"sources":["/projects/nodejs/botbuilder/mgnlq_parser1/src//projects/nodejs/botbuilder/mgnlq_parser1/src/../src/ast.ts"],"names":[],"mappings":"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","file":"ast.js","sourcesContent":["'use strict'\r\n\r\n// based on: http://en.wikibooks.org/wiki/Algorithm_implementation/Strings/Levenshtein_distance\r\n// and:  http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance\r\n\r\nimport * as debugf from 'debugf';\r\nimport * as _ from 'lodash';\r\nconst debuglog = debugf('ast');\r\n\r\nexport enum ASTNodeType {\r\n  BINOP, //0\r\n  OP,\r\n  OPEqIn,\r\n  OPContains,\r\n  OPStartsWith,\r\n  OPEndsWith,\r\n  OPAll,\r\n  OPFirst,\r\n  OPLatest,\r\n  OPNewest,\r\n  OPOldest,\r\n  CAT,\r\n  CATPH,\r\n  FACT,\r\n  LIST, //14\r\n  ANY,\r\n  OPMoreThan,\r\n  OPLessThan,\r\n  OPExactly,\r\n  OPLT,\r\n  OPLE,\r\n  OPNE,\r\n  OPEQ,\r\n  OPGT,\r\n  OPGE,\r\n  OPOrderBy,\r\n  OPOrderDescendingBy,\r\n  OPExisting,\r\n  OPNotExisting,\r\n  OPLogicalAnd,\r\n  OPLogicalOr,\r\n  NUMBER,\r\n  DOM\r\n}\r\n\r\nexport class NodeType {\r\n    nt : ASTNodeType;\r\n  constructor(nt : ASTNodeType) {\r\n    this.nt = nt;\r\n  }\r\n  toString() : string {\r\n    return astNodeTypes[this.nt];\r\n  }\r\n}\r\n\r\nconst astNodeTypes =  [ \"BINOP\",\r\n  \"OP\",\r\n  \"OPEqIn\",\r\n  \"OPContains\",\r\n  \"OPStartsWith\",\r\n  \"OPEndsWith\",\r\n  \"OPAll\",\r\n  \"OPFirst\",\r\n  \"OPLatest\",\r\n  \"OPNewest\",\r\n  \"OPOldest\",\r\n  \"CAT\",\r\n  \"CATPH\",\r\n  \"FACT\",\r\n  \"LIST\",\r\n  \"ANY\",\r\n  \"OPMoreThan\",\r\n  \"OPLessThan\",\r\n  \"OPExactly\",\r\n  \"OPLT\",\r\n  \"OPLE\",\r\n  \"OPNE\",\r\n  \"OPEQ\",\r\n  \"OPGT\",\r\n  \"OPGE\",\r\n  \"OPOrderBy\",\r\n  \"OPOrderDescendingBy\",\r\n  \"OPExisting\",\r\n  \"OPNotExisting\",\r\n  \"OPLogicalAnd\",\r\n  \"OPLogicalOr\",\r\n  \"NUMBER\",\r\n  \"DOM\"\r\n];\r\n\r\nexport interface ASTNode {\r\n  type : ASTNodeType,\r\n  bearer? : any,\r\n  children? : ASTNode[];\r\n};\r\n\r\nexport function makeNode(type : ASTNodeType, ...  args : ASTNode[]) : ASTNode {\r\n  return {\r\n    type : type,\r\n    children : args\r\n  }\r\n}\r\n\r\nexport function makeNodeForCat(cat : any) : ASTNode {\r\n  return {\r\n    type : ASTNodeType.CAT,\r\n    bearer : cat\r\n  }\r\n}\r\n\r\n\r\nexport function makeNodeForDomain(cat : any) : ASTNode {\r\n  return {\r\n    type : ASTNodeType.DOM,\r\n    bearer : cat\r\n  }\r\n}\r\n\r\nexport function makeNodeForToken(type : ASTNodeType, opToken : any) : ASTNode {\r\n  return {\r\n    type : type,\r\n    bearer : opToken\r\n  }\r\n}\r\n\r\n\r\nexport function makeNodeForFact(fact : any) : ASTNode {\r\n  return {\r\n    type : ASTNodeType.FACT,\r\n    bearer : fact\r\n  }\r\n}\r\n\r\n\r\nexport function makeNodeForAny(fact : any) : ASTNode {\r\n  return {\r\n    type : ASTNodeType.ANY,\r\n    bearer : fact\r\n  }\r\n}\r\n\r\nexport function makeNodeForInteger(inttok : any) : ASTNode {\r\n  return {\r\n    type : ASTNodeType.NUMBER,\r\n    bearer : inttok\r\n  }\r\n}\r\n\r\n\r\nexport function typeToString(type : ASTNodeType) {\r\n  return astNodeTypes[type];\r\n}\r\n\r\nexport function dumpNodeNice(node : ASTNode) {\r\n  if (!node) {\r\n    return undefined;\r\n  }\r\n  var r = {  type : typeToString(node.type) } as any;\r\n    r.index = getIndex(node);\r\n    if(node.children && node.children.length) {\r\n      r.children = node.children.map(n => dumpNodeNice(n));\r\n    }\r\n    return r;\r\n}\r\n\r\nfunction getIndex(node : ASTNode) {\r\n  if(!node || !node.bearer) {\r\n    return -1 ;\r\n  }\r\n  return node.bearer.startOffset;\r\n}\r\n\r\nfunction makePrefix(prefix : number, indent : number) {\r\n  var s = '';\r\n  for(var i = 0; i < indent*prefix; ++i) {\r\n    s += ' ';\r\n  }\r\n  return s;\r\n}\r\n\r\nexport function astToText(node : ASTNode, indent? : number, prefix? : number) {\r\n  prefix = prefix || 0;\r\n  indent = indent || 2;\r\n  debuglog(() => JSON.stringify(node,undefined,2));\r\n  var sprefix = makePrefix(prefix, indent);\r\n  var index =  getIndex(node);\r\n  var ln =  node ?  `${typeToString(node.type)} ${index}` : '(undefined)';\r\n  if (!node) {\r\n    return sprefix + node + \"\\n\";\r\n  }\r\n  if(node.children && typeof node.children.length === \"number\") {\r\n      var schildren = node.children.map(c => astToText(c,indent,prefix+1));\r\n      return sprefix + ln + `(${schildren.length})` + '\\n' + schildren.join('');\r\n  } else {\r\n    if(node.children && !_.isArray(node.children)) {\r\n      throw new Error('weird children node' + node.children);\r\n    }\r\n  }\r\n  return sprefix + ln + \"\\n\";\r\n}"],"sourceRoot":"ABC"}